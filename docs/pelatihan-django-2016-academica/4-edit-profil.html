<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="generator" content="ReText 4.1.2">
<title>4-edit-profil</title>
</head>
<body>
<h1>Pelatihan Django 2016 #4 - Melihat dan Mengubah Profil</h1>
<p>Di modul terakhir ini, Anda akan mempelajari bagaimana membuat <em>form</em> otomatis di Django yang sudah dilengkapi dengan validasi. Sehingga Anda tidak perlu membuat validasi sendiri. Kita akan dapat melihat profil mahasiswa dan melakukan edit profil. Disini kita akan menggunakan mekanisme <em>update</em> terhadap tabel <em>users</em> dan <em>akun</em>.</p>
<h2>Persiapan</h2>
<p>Tambahkan dua URL baru untuk "/profil" dan "/profil/edit". Sesuaikan kode <strong>urls.py</strong> Anda dengan kode berikut:</p>
<pre><code>from django.conf.urls import url
from django.contrib import admin
from homepage import views as home_views

urlpatterns = [
    url(r'^admin/', admin.site.urls),
    url(r'^$', home_views.daftar_nilai),
    url(r'^login/$', home_views.login_view),
    url(r'^logout/$', home_views.logout_view),
    url(r'^profil/$', home_views.profil),
    url(r'^profil/edit$', home_views.profil_edit),
]

</code></pre>

<h2>Membuat Fitur Lihat Profil</h2>
<p>Sekarang kita akan menambahkan <em>views</em> <strong>profil</strong> di <strong>homepage/views.py</strong> yang berfungsi untuk melihat profil dari mahasiswa yang sedang <em>login</em>. Sederhanaya, kita ambil data yang ada di tabel Akun kemudian menampilkannya di <em>template</em> yang akan menampilkan data profil mahasiswa tersebut:</p>
<pre><code>@login_required(login_url=settings.LOGIN_URL)
def profil(request):
    user = request.user
    akun = Akun.objects.get(user=user)
    return render(request, 'profil.html', {'user':user, 'akun':akun})
</code></pre>

<p>Sekarang silahkan buat <em>file</em> <strong>profil.html</strong> simpan di dalam <em>folder</em> <strong>homepage/templates</strong>:</p>
<pre><code>&lt;h1&gt;Profil Anda&lt;/h1&gt;

Hi, {{ request.session.username }} | &lt;a href=&quot;/&quot;&gt;Home&lt;/a&gt; |  &lt;a href=&quot;/profil/edit&quot;&gt;Edit Profil&lt;/a&gt; | &lt;a href=&quot;/logout/&quot;&gt;Log out&lt;/a&gt; |

&lt;ul&gt;
    &lt;li&gt;Nama Depan: {{ user.first_name }}&lt;/li&gt;
    &lt;li&gt;Nama Belakang: {{ user.last_name }}&lt;/li&gt;
    &lt;li&gt;E-Mail: {{ user.email }}&lt;/li&gt;
    &lt;li&gt;No. Telepon: {{ akun.no_telp }}&lt;/li&gt;
    &lt;li&gt;Website: {{ akun.website }}&lt;/li&gt;
    &lt;li&gt;Alamat: {{ akun.alamat }}&lt;/li&gt;
&lt;/ul&gt;
</code></pre>

<p>Pada kode diatas, kita dapat melihat bagaimana cara mengakses data <em>session</em> di Django, kemudian kita juga mencoba menampilkan data dari <em>user</em> yang sedang <em>login</em> dan mengakses data yang ada di dalam objek akun. Bila kita lihat di <em>web browser</em> maka akan tampil seperti berikut:</p>
<p><img alt="test" src="screenshot/part4/0.png" width="500px"></p>
<h2>Membuat Fitur Ubah Profil</h2>
<p>Setelah menampilkan profil, saatnya kita hadirkan fitur untuk mengubah profil. Silahkan buat <em>views</em> baru dengan nama <strong>profil_edit</strong> di <strong>homepage/views.py</strong>. Dimana kita akan mengubah dua data yang berada di tabel <strong>User</strong> dan <strong>Akun</strong>. Sekarang tambahkan kode berikut di dalam <strong>homepage/views.py</strong>:</p>
<pre><code>@login_required(login_url=settings.LOGIN_URL)
def profil_edit(request):
    user = request.user
    akun = Akun.objects.get(user=user)

    if request.method == &quot;POST&quot;:
        print request.POST

        user_form = UserForm(request.POST)
        akun_form = AkunForm(request.POST)

        if user_form.is_valid() and akun_form.is_valid():
            user.first_name = request.POST['first_name']
            user.last_name = request.POST['last_name']
            user.email = request.POST['email']
            user.save()

            akun = Akun.objects.get(user=user)
            akun.no_telp = request.POST['no_telp']
            akun.website = request.POST['website']
            akun.alamat = request.POST['alamat']
            akun.save()

            return redirect('/profil')
    else:
        user_form = UserForm(instance=user)
        akun_form = AkunForm(instance=akun)

    return render(request, 'profil_edit.html', {'user_form':user_form, 'akun_form':akun_form})
</code></pre>

<p>Intinya <em>request</em> yang datang dari <em>client</em> akan diperiksa apakah bermetod GET atau POST. Jika GET maka tampilkan <em>form</em> untuk mengubah profil, jika POST maka lakukan validasi dan jika validasi berhasil maka ubah profil di <em>database</em>, dan kembalikan ke halaman <strong>"/profil"</strong>.</p>
<p>Sedangkan berikut adalah <em>form</em> untuk mengubah profil. Silahkan buat <em>file</em> baru dengan bana <strong>profil_edit.html</strong> dan simpan di <strong>homepage/templates</strong>:</p>
<pre><code>&lt;h1&gt;Edit Profil Anda&lt;/h1&gt;

&lt;form id=&quot;new-artist-form&quot; action=&quot;/profil/edit&quot; method=&quot;POST&quot; role=&quot;form&quot;&gt;
    {% csrf_token %}

    {% if user_form.errors %}
        {{ user_form.errors }}
    {% endif %}

    {% if akun_form.errors %}
        {{ akun_form.errors }}
    {% endif %}

    Nama Depan: 
    {{ user_form.first_name }}

    &lt;br/&gt;
    &lt;br/&gt;

    Nama Belakang: 
    {{ user_form.last_name }}

    &lt;br/&gt;
    &lt;br/&gt;

    E-Mail: 
    {{ user_form.email }}

    &lt;br/&gt;
    &lt;br/&gt;

    No. Telepon: 
    {{ akun_form.no_telp }}

    &lt;br/&gt;
    &lt;br/&gt;

    Website: 
    {{ akun_form.website }}

    &lt;br/&gt;
    &lt;br/&gt;

    Alamat: 
    &lt;br/&gt;
    {{ akun_form.alamat }}

    &lt;br/&gt;
    &lt;br/&gt;

    &lt;input href=&quot;javascript:void(0);&quot; value=&quot;Simpan&quot; type=&quot;submit&quot;/&gt;
    &lt;a href=&quot;/profil&quot;&gt;Batal&lt;/a&gt;
&lt;/form&gt;
</code></pre>

<p>Berikut adalah tampilan halaman ubah profil:</p>
<p><img alt="test" src="screenshot/part4/1.png"  width="500px"></p>
<p><img alt="test" src="screenshot/part4/2.png"  width="500px"></p>
<p><img alt="test" src="screenshot/part4/3.png"  width="500px"></p>
<p><img alt="test" src="screenshot/part4/4.png"  width="500px"></p>
</body>
</html>
